<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>List</title>
        <!--ajax-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <!--CSS-->
        <link rel="stylesheet" href="general_css.css">
        <!--Header-->
        <%- include('../partials/header'); %>
    </head>
    <style>
    table {
        border-collapse: collapse;
        border: 2px solid rgb(140, 140, 140);
        width: 95%;
    }
    th, td {
        border-collapse: collapse;
        border: 2px solid rgb(140, 140, 140);
        text-align: center;
    }

    #table_container {
        width: 100%;
        display: flex;
        justify-content: center;
    }
    #td_button_container {
        display: grid;
        grid-template-columns: auto auto auto;
        gap: 10px;
    }
    #td_button_container>div {
        padding: 10px;
        transition: transform 0.2s; /* Smooth transition for scaling */
    }
    #td_button_container>div>button {
        border: none;
        padding: 5px; /* Increase padding for better appearance */
        cursor: pointer;
        width: 100%; /* Ensure buttons take full div width */
        transition: 0.35s;
        border-radius: 10px;
    }
    #td_button_container>div>button:hover {
        transform: scale(1.1); /* Scale up the button on hover */
        box-shadow: 3px 3px 10px black;
    }
    #td_button_container>div>.btn2 {
        background-color: red;
        color: white;
    }
    #td_button_container>div>.btn3 {
        background-color: rgb(71, 71, 71);
        color: white;
    }
    #td_button_container>div>.btn1 {
        background-color: rgb(110, 152, 231);
        color: white;
    }
    </style>
    <body>
        <div class="has_sidebar">
            <%- include('../partials/sidebar'); %>
            <div>
                <h1 id="list_header"></h1>
                <div>Tottal Number Of <span id="span_number_of">companys</span> : <%=list_items.length%></div>
                <div id="table_container">
                    <table>
                          <thead>
                            <tr>
                                <th>A/A</th>
                                <% column_titles.forEach(function(column_title, index) { %>
                                    <% if (searchfor == 'docs' && index > 0) { %>
                                        <th><%= column_title %></th>
                                    <% } %>
                                <% }); %>
                                
                                <th></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                                <%if(list_items.length == 0){%>
                                    <% for (let i = 0; i <= column_titles.length; i++) { %>
                                        <% if (searchfor == 'docs' && i > 0) { %>
                                            <th>-</th>
                                        <% } %>
                                    <% } %>
                                <%}
                                else{
                                    list_items.forEach(function(list_item, index) { %>
                                        <tr>
                                            <td><%= index + 1 %></td>
                                            <% for (let i = 0; i < list_item.data.length; i++) { %>
                                                <% if (searchfor !== 'docs') { %>
                                                    <td><%= list_item.data[i] %></td>
                                                <% } else if (i > 0) { %>
                                                    <td><%= list_item.data[i] %></td>
                                                <% } %>
                                            <% } %>
                                            
                                            <td>
                                                <div id="td_button_container">
                                                    <div><button class="btn1" data-id="<%= list_item.data[0] %>">View</button></div>
                                                    <div><button class="btn2" data-id="<%= list_item.data[0] %>">Delete</button></div>
                                                    <div><button class="btn3" data-id="<%= list_item.data[0] %>">Block</button></div>
                                                </div>
                                            </td>

                                        </tr>
                                    <% });
                                }%>

                            </tr>
                          </tbody>
                    </table>
                </div>
            </div>
        </div>
        <iframe id="print-frame" style="display:none;"></iframe>

    </body>
    <%- include('../partials/footer'); %>
    <!--script type = "text/javascript" src="../../JSFrontEndFunctions.js"></script-->  
    <script>
    $(document).ready(function(){
        var  searchfor = '';
        if (window.location.search) {
            searchfor = new URLSearchParams(window.location.search).get('searchfor');
            if(searchfor =='companys'){
                $("#list_header").html('Companys List');
                $("#span_number_of").html('companys');
            }
            else if(searchfor =='users'){
                $("#list_header").html('Users List');
                $("#span_number_of").html('users');
            }
            else if(searchfor =='docs'){
                $('.btn3').text('Print')
                $('.btn3').click(print_doc)
            }

            $('.btn1').click(print_doc)
            $('.btn2').click(print_doc)
        }
        
        $("#back_btn").click(function(){
            window.location ="/";
        });

        function print_doc(){
            var index = $(this).closest('tr').find('td:first').text() -1;
            alert($(".btn1").eq(index-1).data('id'));
            print_form();

        }
        function view_doc(){
            var index = $(this).closest('tr').find('td:first').text() -1;
            alert($(".btn1").eq(index-1).data('id'));
        }
        function delete_doc(){
            var index = $(this).closest('tr').find('td:first').text() -1;
            alert($(".btn1").eq(index-1).data('id'));
        }
        function block(){
            var index = $(this).closest('tr').find('td:first').text() -1;
            alert($(".btn1").eq(index-1).data('id'));
        }

        function print_form() {
            var iframe = document.getElementById('print-frame');
            var doc = iframe.contentWindow.document;

                var form = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta http-equiv="cache-control" content="no-cache">
                        <meta http-equiv="Pragma" content="no-cache">
                        <meta http-equiv="Expires" content="-1">
                        <title>Title</title>
                        <style>
                            @media print {
                                @page {
                                    margin: 0;
                                }
                                body {
                                    margin: 0;
                                    padding: 0;
                                }
                                #print-frame {
                                    display: none;
                                }
                                /* Hide elements you don’t want to print */
                                header, footer {
                                    display: none;
                                }
                            }
                            #type {
                                background-color: black;
                                width: 100%;
                                text-indent: 20px;
                                font-size: 40px;
                                font-weight: bold;
                                color: white;
                                margin-top: 50px;
                            }
                            #doc_num {
                                text-align: right;
                                display: flex;
                                justify-content: right;
                                align-items: center;
                            }
                            #doc_num > span {
                                margin-right: 20px;
                            }
                            table {
                                border-collapse: collapse;
                                border: 2px solid rgb(140, 140, 140);
                                width: 100%;
                            }
                            th, td {
                                border-collapse: collapse;
                                border: 2px solid rgb(140, 140, 140);
                                text-align: center;
                            }
                            table > tbody > tr > td > div {
                                display: grid;
                                grid-template-columns: 70% 30%;
                            }
                            header {
                                display: grid;
                                grid-template-columns: 40% 60%;
                            }
                            header > div {
                                width: 100%;
                                font-size: 20px;
                                margin-top: 50px;
                            }
                            body {
                                margin: 0;
                                padding: 0;
                            }
                            hr {
                                width: 50%;
                                border: none;
                                height: 1.5px;
                                background-color: black;
                                margin: 10px 0;
                            }
                            #persons_data {
                                display: grid;
                                grid-template-columns: 49% 49%;
                                gap: 2%
                            }
                            #persons_data > div > div {
                                display: grid;
                                grid-template-columns: 50% 50%;
                            }
                            #main_body{
                                margin: 10px;
                            }
                            #company_name
                            {
                                margin: 10px;
                            }
                        </style>
                    </head>
                    <body>
                        <header>
                            <div id="type">Invoice</div>
                            <div id="doc_num">No. <span>9999</span></div>
                        </header>
                        <div id='company_name'>Company Name</div>
                        <hr>
                        <div id='main_body'>
                            <div>DD/MM/YYYY</div>
                            <div id="persons_data">
                                <div>
                                    <div>Bill To</div>
                                    <div>
                                        <div>Customer Name</div>
                                        <div>Name</div>
                                        <div>Email:</div>
                                        <div>xxx@xxx.com</div>
                                        <div>VAT:</div>
                                        <div>999 999 999</div>
                                        <div>Phone:</div>
                                        <div>222 333 22</div>
                                    </div>
                                </div>
                                <div>
                                    <div>Bill To</div>
                                    <div>
                                        <div>Customer Name</div>
                                        <div>Name</div>
                                        <div>Email:</div>
                                        <div>xxx@xxx.com</div>
                                        <div>VAT:</div>
                                        <div>999 999 999</div>
                                        <div>Phone:</div>
                                        <div>222 333 22</div>
                                    </div>
                                </div>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>A/A</th>
                                        <th>Title</th>
                                        <th>Qty</th>
                                        <th>Tax</th>
                                        <th>Discount</th>
                                        <th>Discount %</th>
                                        <th>U/P</th>
                                        <th>Value</th>
                                        <th>Price After Discount</th>
                                        <th>Final Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Title</td>
                                        <td>1</td>
                                        <td>&nbsp;%</td>
                                        <td>0&nbsp;€</td>
                                        <td>0&nbsp;%</td>
                                        <td>95</td>
                                        <td>95</td>
                                        <td>90</td>
                                        <td>100</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div>
                                <div>Wholesale / Retail</div>
                                <div>Total Value: <span id="total_value">0.00</span> €</div>
                                <div>Total Discounts: <span id="total_disc">0.00</span> €</div>
                                <div>Total Price after Discounts: <span id="total_after_disc">0.00</span> €</div>
                                <div>Total Price after Tax: <span id="total_after_tax">0.00</span> €</div>
                                <br>
                                <div>Discount: <span>0.00</span> %</div>
                                <div>Discount Amount: <span>0.00</span> €</div>
                                <div>Total Cost: <span id="total_cost">0.00</span> €</div>
                            </div>
                        </div>
                    </body>
                    </html>`;
                doc.open();
                doc.write(form);
                doc.close();

                // Trigger the print dialog
                iframe.contentWindow.focus();
                iframe.contentWindow.print();
        }       
    });
    
    </script>
</html>
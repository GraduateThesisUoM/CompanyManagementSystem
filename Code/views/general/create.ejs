<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Create</title>
        <!--ajax-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/x-icon" href="logo.svg">

        <!--CSS-->
        <link rel="stylesheet" href="general_css.css">
        <link rel="stylesheet" href="create_css.css">
        <link rel="stylesheet" href="fonts_css.css">
        <link rel="stylesheet" href="Switch_css.css">
        <link rel="stylesheet" href="Lock_css.css">
        <link rel="stylesheet" href="buttons_css.css">
        <link rel="stylesheet" href="textarea_css.css">
        <link rel="stylesheet" href="my_select_css.css">
        
        <script type="text/javascript" src="JSFrontEndFunctions.js"></script>

        <!--Fonts-->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Asap+Condensed:wght@400;700&display=swap" rel="stylesheet" />

        <!--Header-->
        <%- include('../partials/header'); %>
    </head>
    <body>
        <div class="has_sidebar ">
            <%- include('../partials/sidebar'); %>
            <div class="has_sidebar_main_content">
                <h1 class="asap-condensed-extralight">Create</h1>

                <form action="/create" method="POST" id="create_form" class="glass_effect_2 container asap-condensed-regular">
                    <input type="text" id="create_type"  name="create_type" style="display: none;">
                    <div id = 'Warehouse_div' class="create_div">
                        <label class="my_label_1" for="warehouse_title">Title : </label>
                        <input class="input_type_1" type="text" id="warehouse_title" name="warehouse_title" class="required warehouse">
                        <label class="my_label_1" for="warehouse_address">Address : </label>
                        <input class="input_type_1" type="text" id="warehouse_address" name="warehouse_address" class="required warehouse">
                    </div>
                    <div id = 'items_div' class="create_div">
                        <label class="my_label_1" for="items_title">Title : </label>
                        <input class="input_type_1" type="text" id="items_title" name="items_title" class="required items">
                        <label class="my_label_1" for="items_description">Description : </label>
                        <div class="textarea_container">
                            <textarea id = "items_description" name = "items_description" class="required items "></textarea>
                        </div>

                        <div style="display: flex;flex-direction: column;margin-top: 20px;">
                            <label style="width: 100%;"  class="my_label_1">Unit Of Measure : </label>
                        <select style="width: 50%; padding: 10px;border-radius: 10px; font-size: 1.53em;" class="my_select">
                            <option value="pcs">Pcs</option>
                            <option value="m">m</option>
                            <option value="cm">cm</option>
                            <option value="box">Box</option>
                            <option value="l">L</option>
                            <option value="ml">ml</option>
                            <option value="kg">Kg</option>
                            <option value="grms">Grms</option>
                        </select>
                        </div>

                        


                        <div style="display: grid;grid-template-columns: 5% 45% 45%;margin-top: 20px; gap:2.5%; margin-bottom:30px">
                            <label class="my_label_1" style="visibility: hidden;">- </label>
                            <label class="my_label_1">Retail : </label>
                            <label class="my_label_1">Wholesale : </label>

                            <label class="my_label_1 center_1">Price € : </label>
                            <input type="number" id="items_price_r" name="items_price_r" value="0"  class="required items price retale input_type_1">
                            <input type="number" id="items_price_w" name="items_price_w" value="0" class="required items price wholesale input_type_1">

                            <label class="my_label_1 center_1">Disc € : </label>
                            <input type="number" id="items_price_r_disc" name="items_price_r_disc" min="0" value="0" class="required items disc retale input_type_1" >
                            <input type="number" id="items_price_w_disc" name="items_price_w_disc" min="0" value="0" class="required items disc wholesale input_type_1">

                            <label class="my_label_1 center_1">Disc % : </label>
                            <input type="number" id="items_price_r_disc_p" name="items_price_r_disc_p" min="0" value="0" max = "100" class="required items percent retale input_type_1">
                            <input type="number" id="items_price_w_disc_p" name="items_price_w_disc_p" min="0" value="0" max = "100" class="required items percent wholesale input_type_1">
                        
                            <label class="my_label_1 center_1">Tax % : </label>
                            <input type="number" id="items_tax_r" name="items_tax_r" min="0" value="0" max = "100" class="required items input_type_1">
                            <input type="number" id="items_tax_w" name="items_tax_w" min="0" value="0" max = "100" class="required items input_type_1">
                        </div>
                        <div style="display: grid;grid-template-columns: 50% 50%;margin-top: 20px; margin-bottom:30px">
                            <label id="item_retail_full" class="my_label_1" style="width: 100%;text-align: center;">0.00 €</label>
                            <label id="item_wholesale_full" class="my_label_1" style="width: 100%;text-align: center;">0.00 €</label>
                        </div>
              
                     
                    </div>
                    <div id ='series_div' class="create_div font_size_1">
                        <div>
                            <label for="series_title">Title : </label>
                            <input type="text" id="series_title" name="series_title"  class="required series input_type_1 font_size_1">
                        </div>
                       <div>
                            <label for="series_acronym">Acronym : </label>
                            <input type="text" id="series_acronym" name="series_acronym"  class="required series input_type_1 font_size_1">
                       </div>
                        <div>
                            <div class="lock_container">
                                <div class="lock">
                                    <div class="top_lock"></div>
                                    <div class="bottom_lock locked"></div>
                                </div>
                                <label>Unlocked</label>
                                <input name = "series_sealed" value="0" style="display: none;">
                            </div>
                        </div>
                        <div>
                            <div class="switch_container" id="effects_warehouse_y_n">
                                <div class="switch">
                                    <div class="back_text">
                                      <div></div>
                                      <div></div>
                                    </div>
                                    <div class="slider">
                                      <button class="slider-button active" id="effects_warehouse_y_n_switch_btn"></button>
                                    </div>
                                </div>
                                <div class="switch_label" id="effects_warehouse_y_n_label">Does Not Effects Warehouse</div>
                            </div>
                            <input id = 'effects_warehouse_y_n_input' name="effects_warehouse_y_n_input" value="0" style="display: none;">

                            <div class="switch_container" id="effects_warehouse_switch">
                                
                                <div class="switch">
                                    <div class="back_text">
                                      <div></div>
                                      <div></div>
                                    </div>
                                    <div class="slider">
                                      <button class="slider-button" id="effects_warehouse_switch_btn"></button>
                                    </div>
                                </div>
                                <div class="switch_label" id="effects_warehouse_label">Adds</div>
                            </div>
                        </div>
                        <div>
                            <div class="switch_container" id="effects_accounts_y_n">
                                
                                <div class="switch">
                                    <div class="back_text">
                                      <div></div>
                                      <div></div>
                                    </div>
                                    <div class="slider">
                                      <button class="slider-button active" id="effects_accounts_y_n_switch_btn"></button>
                                    </div>
                                </div>
                                <div class="switch_label" id="effects_accounts_y_n_label">Does Not Affects Account</div>
                            </div>
                            <input id = 'effects_accounts_y_n_input' name="effects_accounts_y_n_input" value="0" style="display: none;">

                            <div class="switch_container" id="effects_accounts_switch">
                                
                                <div class="switch">
                                    <div class="back_text">
                                      <div></div>
                                      <div></div>
                                    </div>
                                    <div class="slider">
                                      <button class="slider-button" id="effects_accounts_switch_btn"></button>
                                    </div>
                                </div>
                                <div class="switch_label" id="effects_accounts_label">Adds</div>
                            </div>
                            
                        </div>
                        
                        <div class="switch_container" id="transforms_y_n">
                                
                            <div class="switch">
                                <div class="back_text">
                                  <div></div>
                                  <div></div>
                                </div>
                                <div class="slider">
                                  <button class="slider-button active" id="transforms_y_n_switch_btn"></button>
                                </div>
                            </div>
                            <div class="switch_label" id="transforms_y_n_label">Does Not Transforms</div>
                        </div>
                        <input id = 'transforms_y_n_input' name="transforms_y_n_input" value="0" style="display: none;">


                        <div id = 'transforms_to_div'>
                        </div>
                    </div>
                    <div id ='persons_div' class="create_div" style="display: flex;flex-direction: column;">
                        <label for="person_firstName" class="my_label_1">First Name : </label>
                        <input type="text" id="person_firstName" name="person_firstName"  class="required person input_type_1">
                        <label for="person_lastName" class="my_label_1">Last Name : </label>
                        <input type="text" id="person_lastName" name="person_lastName"  class="required person input_type_1">
                        <label for="person_email" class="my_label_1">Email : </label>
                        <input type="email" id="person_email" name="person_email"  class="required person input_type_1">
                        <label for="person_phone" class="my_label_1">Phone : </label>
                        <input type="number" id="person_phone" name="person_phone"  class="required person input_type_1">
                        <label for="person_vat" class="my_label_1">VAT : </label>
                        <input type="number" id="person_vat" name="person_vat"  class="person input_type_1">

                        <label for="person_address" class="my_label_1">Address : </label>
                        <input type="text" id="person_address" name="person_address"  class="person input_type_1">
                        <label for="person_district" class="my_label_1">District : </label>
                        <input type="text" id="person_district" name="person_district"  class="person input_type_1">
                        <label for="person_city" class="my_label_1">City : </label>
                        <input type="text" id="person_city" name="person_city"  class="person input_type_1">
                        <label for="person_country" class="my_label_1">Country : </label>
                        <input type="text" id="person_country" name="person_country"  class="person input_type_1">
                        <label for="person_zip" class="my_label_1">Zip : </label>
                        <input type="number" id="person_zip" name="person_zip"  class="person input_type_1">
                    </div>
                    <input type="number" id="obj_type" name="obj_type" style="display: none;">
                </form>
                <button id="my_submit_btn" class="submit_btn button_4" style="margin-bottom:50px" type="button">Submit</button>
            </div>
        </div>
    </body>
    <script>
    message_from_url(window.location.href);

    $(document).ready(function(){
        const queryString = new URL(window.location.href).search;
        const params = new URLSearchParams(queryString);
        var type = '';
        var  create = '';
        const secondery_data = JSON.parse(`<%- JSON.stringify(secondary_data) %>`);

        $(".create_div").hide();
        $("#my_submit_btn").hide();
        
        
        $("#my_submit_btn").click(my_submit);
        
        if (window.location.search) {
            if(params.get('create')){
                
                $("#create_type").val(params.get('create'));
                $(".create_div").hide();
                $("#"+params.get('create')+"_div").show();
                $("#my_submit_btn").show();

                $(".required").attr('required', false);
                $(".required." + params.get('create')).attr('required', true);
                

                $(".create_menu_btn").removeClass("selected");
                
                if(params.get('create') != 'Warehouse' ){
                    if(params.get('create') != 'items'){
                        if(params.get('type')){
                            $("#obj_type").val(params.get('type'));
                        }
                        else{
                            window.location = '/';
                        }
                    }
                }
                if(params.get('create') == 'series'){
                    for(s of secondery_data){
                        console.log(s.title)
                        $("#transforms_to_div").append(`
                        <div class="switch_container">
                            <div class="switch">
                            <div class="back_text">
                                <div></div>
                                <div></div>
                            </div>
                            <div class="slider">
                                <button id='${s._id}' class="slider-button transfomrs_to_s active" ></button>
                            </div>
                            </div>
                            <div class="switch_label">${s.acronym}- ${s.title}</div>
                        </div>
                        `);
                    }
                    if(secondery_data.length==0){
                        $("#transforms_y_n").hide();
                        $("#transforms_to_div").hide();
                    }
                    
                }

            }
            else{
                window.location = '/';
            }
        }
        else{
            window.location = '/';
        }

        $(".disc").attr('readonly', true);
        
        $(".percent").attr('readonly', true);


        function my_submit(){
            console.log("submit")
            var type = $('#create_type').val();
            if(type == 'items'){
                get_other_value('items_price_w','items_price_r');
                //get_other_value('items_price_r','items_price_w');
                get_other_value('items_price_w_disc','items_price_r_disc');
                //get_other_value('items_price_2_disc','items_price_w_disc');
                get_other_value('items_tax_r','items_tax_w');
            }
            $("#create_form").submit();
        }

        function get_other_value(obj_id1,obj_id2){
            var obj_1 = $("#"+obj_id1);
            var obj_2 = $("#"+obj_id2);
            if(obj_1.val()==0){
                obj_1.val(obj_2.val())
            }
            else if (obj_2.val()==0){
                obj_2.val(obj_1.val())
            }
        }

        function price_discount_input(event){
            var selected_elements =[];
            //var item_type = 'wholesale';
            var item_type_mark = 'w';
            

            //selected_elements = $("."+item_type);

            if ($(event.target).hasClass('retale')) {
                //item_type = "retale";
                item_type_mark = 'r';
            }

            var price = $("#items_price_"+item_type_mark);
            var dic = $("#items_price_"+item_type_mark+"_disc");
            var percentage = $("#items_price_"+item_type_mark+"_disc_p");

            if($(event.target).hasClass('price')) {
                if(percentage.val()> 0){
                    dic.val(price.val()*(percentage.val()/100))
                }
                else if (dic.val()>0){
                    percentage.val((100*dic.val())/price.val())
                }
               if(price.val()> 0 && price.val() !=null){
                    dic.attr('readonly', false);
                    percentage.attr('readonly', false);
               }
               else{
                    dic.val(0);
                    dic.attr('readonly', true);
                    percentage.attr('readonly', true);
               }
            }
            else if($(event.target).hasClass('disc')) {
                percentage.val((100*dic.val())/price.val())
            }
            else if($(event.target).hasClass('percent')) {
                dic.val(price.val()*(percentage.val()/100))
                //dic.val(price.val()*(percentage.val()/100))
            }
        }

        $('.disc').on('input', price_discount_input);
        $('.percent').on('input', price_discount_input);
        $('.price').on('input', price_discount_input);

        $("#effects_warehouse_switch").hide();
        $("#effects_accounts_switch").hide();
        $("#transforms_to_div").hide();    


        $("#effects_accounts_switch_btn").click(function(event){
            event.preventDefault();
            event.preventDefault(); // Prevent the default action
            this.classList.toggle('active'); // Toggle the `active` class
            if($(this).hasClass('active')){
                $("#effects_accounts_label").html('Subtracts'); // Change text to "+"
                $("#effects_accounts_y_n_input").val(-1)
            } else {
                $("#effects_accounts_label").html('Adds');
                $("#effects_accounts_y_n_input").val(1)
            }
        })

        $("#effects_accounts_y_n_switch_btn").click(function(event){
            event.preventDefault();
            event.preventDefault(); // Prevent the default action
            this.classList.toggle('active'); // Toggle the `active` class
            $("#effects_accounts_switch").toggle();

            if($(this).hasClass('active')){
                $("#effects_accounts_y_n_input").val(0);
                $("#effects_accounts_y_n_label").html("Does Not Affects Account")
            }
            else{
                $("#effects_accounts_y_n_input").val(1);
                $("#effects_accounts_y_n_label").html("Affects Account")

            }
        })

       
        $("#effects_warehouse_switch_btn").click(function(event){
            event.preventDefault(); // Prevent the default action
            this.classList.toggle('active'); // Toggle the `active` class
            if($(this).hasClass('active')){
                $("#effects_warehouse_label").html('Subtracts'); // Change text to "+"
                $("#effects_warehouse_y_n_input").val(-1)
            } else {
                $("#effects_warehouse_label").html('Adds');
                $("#effects_warehouse_y_n_input").val(1)
            }
        })

        $("#effects_warehouse_y_n_switch_btn").click(function(event){
            event.preventDefault(); // Prevent the default action
            this.classList.toggle('active'); // Toggle the `active` class
            $("#effects_warehouse_switch").toggle();

            if($(this).hasClass('active')){
                $("#effects_warehouse_y_n_label").html("Does Not Affects Warehouse")
                $("#effects_warehouse_y_n_input").val(0);
            }
            else{
                $("#effects_warehouse_y_n_label").html("Affects Warehouse");
                $("#effects_warehouse_y_n_input").val(1);

            }
        })


        $("#transforms_y_n_switch_btn").click(function(event){
            event.preventDefault(); // Prevent the default action
            this.classList.toggle('active'); // Toggle the `active` class
            $("#transforms_to_div").toggle();
            
            if($(this).hasClass('active')){
                $("#transforms_y_n_label").html("Does Not Transforms")
                $("#transforms_y_n_input").val(0);
            }
            else{
                $("#transforms_y_n_label").html("Transforms");
                $("#transforms_y_n_input").val(1);

            }
        })


        $(".lock").click(function (event) {
        event.stopPropagation();
        event.preventDefault();

        // Find the .top_lock inside the clicked .lock and toggle the locked class
        const lockContainer = $(this).closest(".lock_container");
        const topLock = $(this).find(".top_lock");
        const label = lockContainer.find("label");
        const input = lockContainer.find("input");

        // Toggle the locked class
        topLock.toggleClass("locked");

        // Update the label text and input value based on the lock state
        if (topLock.hasClass("locked")) {
            label.text("Locked"); // Update label text
            input.val(1); // Update input value
        } else {
            label.text("Unlocked"); // Update label text
            input.val(0); // Update input value
        }
    });

        $(".transfomrs_to_s").click(function(event){
            event.preventDefault();
            this.classList.toggle('active'); // Toggle the `active` class
            $("#transforms_y_n_input").val("");
            for(s of $(".transfomrs_to_s:not(.active)")){
                if($("#transforms_y_n_input").val() ==""){
                    $("#transforms_y_n_input").val($(s).attr('id'))
                }
                else{
                    $("#transforms_y_n_input").val(
                        $("#transforms_y_n_input").val()+
                        ";"+
                        $(s).attr('id')
                    );
                }
            }
        })
        
        $(".items").on('input', function(){
            var price_r = parseFloat($("#items_price_r").val());
            var price_w = parseFloat($("#items_price_w").val());
            var price_r_disc = parseFloat($("#items_price_r_disc").val());
            var price_w_disc = parseFloat($("#items_price_w_disc").val());
            var price_r_disc_p = parseFloat($("#items_price_r_disc_p").val());
            var price_w_disc_p = parseFloat($("#items_price_w_disc_p").val());
            var price_r_tax = parseFloat($("#items_tax_r").val());
            var price_w_tax = parseFloat($("#items_tax_w").val());

            price_w = price_w - price_w_disc;
            price_r = price_r - price_r_disc;

            var price_w_after_tax = price_w + (price_w*price_w_tax/100);
            var price_r_after_tax = price_r + (price_r*price_r_tax/100);


            $("#item_retail_full").html(price_r_after_tax.toFixed(2) + " €");
            $("#item_wholesale_full").html(price_w_after_tax.toFixed(2)+ " €");
        })

    });
    
    </script>
</html>
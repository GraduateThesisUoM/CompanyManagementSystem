<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="modal.css">
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script> -->
    <title>User Profile</title>
</head>
<body>
    <div id="user-info-admin-div" name="user-info-admin-div">
        <h1><%= user.firstName; %> <%= user.lastName; %></h1>
        <h2>Email: <%= user.email; %></h2>
        <h2>User type: <%= user.type; %></h2>
        <h2>Ban status: <%= user.account_status; %></h2>

        <form action="/changeBanStatus?id=<%=user._id%>"  method="POST">
            <% if(user.account_status === "banned"){ %>
                <input type="submit" id="change_ban_status_button" name="change_ban_status_button" value="Unban">
            <% }else{ %>
                <input type="submit" id="change_ban_status_button" name="change_ban_status_button" value="Ban">
            <% } %>
        </form>
        
    </div>
    <div id="user-reviews-admin-div" name="user-reviews-admin-div">
        <h1>Reviews</h1>
    </div>
    <hr>
    <h1>Relationships</h1>
    <hr>
    <h1>Pending Reports</h1>
    <span>Show Reports For User</span>
    <label class="switch">
        <input type="checkbox" id="reports-toggle" name="reports-toggle" onclick="modal.showCorrectReports()">
        <span class="slider round"></span>
    </label>
    <span>Show Reports By User</span>
    <br>

    <div id="reports-for-user-admin-div" name="reports-for-user-admin-div">
        <span id="no-reports-for-span" name="no-reports-for-span">No reports to show</span>
        <%if(reports_for.length > 0){ %>
            <script>document.getElementById('no-reports-for-span').style.display = 'none';</script>
            <%for(var i=0; i<reports_for.length ;i++){ %>
                <span>Report Reason: <%= reports_for[i].reason %></span>
                <br>
                <span>Reported on: <%= reports_for[i].registrationDate %></span>
                <br>
                <span>Reported by: <a href="/userProfile?id=<%=reports_for[i].reporter_id%>">User</a></span>
                <br>
                <button class="reportButtons" id="visitReport" name="visitReport" onclick="modal.createAndOpen('<%- reports_for[i]._id %>','<%- reports_for[i].reason %>', '<%- reports_for[i].text %>', '<%- reports_for[i].registrationDate %>')">Details</button>
                <br>
                <br>
            <%}
        }%>
    </div>

    <div id="reports-by-user-admin-div" name="reports-by-user-admin-div"  style="display: none;">
        <span id="no-reports-by-span" name="no-reports-by-span">No reports to show</span>
        <%if(reports_by.length > 0){%>
            <script>document.getElementById('no-reports-by-span').style.display = 'none';</script>
            <%for(var i=0; i<reports_by.length ;i++){ %>
                <span>Report Reason: <%= reports_by[i].reason %></span>
                <br>
                <span>Reported on: <%= reports_by[i].registrationDate %></span>
                <br>
                <span>Reported: <a href="/userProfile?id=<%=reports_by[i].reported_id%>">User</a></span>
                <br>
                <button class="reportButtons" id="visitReport" name="visitReport" onclick="modal.createAndOpen('<%- reports_by[i]._id %>','<%- reports_by[i].reason %>', '<%- reports_by[i].text %>', '<%- reports_by[i].registrationDate %>')">Details</button>
                <br>
                <br>
            <%}
        }%>
    </div>

</body>

<script>
    //class for the report modal
    class ReportModal{
    constructor({
        title,
        details,
        date,
        reviewed,
        dismissed,
        cancel
    }){
        this.title = title;
        this.details = details;
        this.date = date;
        this.reviewed = 'Mark as reviewed',
        this.dismissed = 'Dismiss',
        this.cancel = 'X'
    }

    showCorrectReports(){
        if(document.getElementById('reports-toggle').checked){
            document.getElementById('reports-for-user-admin-div').style.display = 'none';
            document.getElementById('reports-by-user-admin-div').style.display = 'block';
        }
        else{
            document.getElementById('reports-for-user-admin-div').style.display = 'block';
            document.getElementById('reports-by-user-admin-div').style.display = 'none';
        }
    }

    

    createAndOpen(id, reason, text, date, resolve, reject){
        this.modalElem = document.createElement('div');
        this.modalElem.classList.add('modal');
        setTimeout(()=>{
            this.modalElem.classList.add('open');
        }, 400);


        const modalContentElem = document.createElement('div');
        modalContentElem.classList.add('content');

        this.modalElem.appendChild(modalContentElem);

        //cancel
        const cancelTextElem = document.createElement('button');
        cancelTextElem.classList.add('cancel');
        cancelTextElem.textContent = this.cancel;

        modalContentElem.appendChild(cancelTextElem);

        cancelTextElem.addEventListener('click', () =>{
            this.close();
        });

        this.modalElem.addEventListener('click', event => {
            if (event.target.className === 'modal open') {
                this.close()
            }
        });

        
        //title
        const titleTextElem = document.createElement('p');
        titleTextElem.classList.add('title');
        titleTextElem.textContent = reason;

        modalContentElem.appendChild(titleTextElem);

        //date
        const dateTextElem = document.createElement('p');
        dateTextElem.classList.add('date');
        dateTextElem.textContent = date;

        modalContentElem.appendChild(dateTextElem);


        //details
        const detailsTextElem = document.createElement('p');
        detailsTextElem.classList.add('details');
        detailsTextElem.textContent = text;

        modalContentElem.appendChild(detailsTextElem);

        //reviewed
        const reviewedButtonForm = document.createElement('form');
        reviewedButtonForm.setAttribute('action', '/reviewReport?id='+id);
        reviewedButtonForm.setAttribute('method', 'POST');
        
        const reviewedTextElem = document.createElement('input');
        reviewedTextElem.setAttribute('type', 'submit');
        reviewedTextElem.classList.add('reviewed');
        reviewedTextElem.value = this.reviewed;

        reviewedButtonForm.appendChild(reviewedTextElem);
        modalContentElem.appendChild(reviewedButtonForm);


        //dismissed
        const dismissedButtonForm = document.createElement('form');
        dismissedButtonForm.setAttribute('action', '/dismissReport?id='+id);
        dismissedButtonForm.setAttribute('method', 'POST');


        const dismissedTextElem = document.createElement('input');
        dismissedTextElem.setAttribute('type', 'submit');
        dismissedTextElem.classList.add('dismissed');
        dismissedTextElem.value = this.dismissed;

        dismissedButtonForm.appendChild(dismissedTextElem);
        modalContentElem.appendChild(dismissedButtonForm);

        document.body.appendChild(this.modalElem);
    }

    open(){
        return new Promise((resolve, reject)=>{
            this.createAndOpen(resolve, reject);
        });
    }

    close(){
        this.modalElem.classList.remove('open');
        setTimeout(()=>{
            document.body.removeChild(this.modalElem);
        }, 400);
    }
}

    const modal = new ReportModal({
        title: 'Title Goes Here',
        details: 'These are the Details',
        date: 'This is the Date',
        reporter:'This is the Person Reporting',
        reported:'This is the Person being Reported'
    });
</script>

</html>